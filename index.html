<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Shopify Compliance Analyzer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow-x: hidden;
            background: #f8fafc;
        }
        
        /* Fix for mobile inputs */
        input, select, textarea, button {
            font-size: 16px !important;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }
        
        /* Prevent zoom on iOS */
        @media screen and (max-width: 768px) {
            input, select, textarea {
                font-size: 16px !important;
            }
        }
        
        /* Mobile menu styles */
        .mobile-menu {
            transform: translateX(-100%);
            transition: transform 0.3s ease;
        }
        
        .mobile-menu.active {
            transform: translateX(0);
        }
        
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 40;
        }
        
        .overlay.active {
            display: block;
        }
        
        /* Settings modal */
        .settings-modal {
            transform: scale(0.9);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 60;
        }
        
        .settings-modal.active {
            transform: scale(1);
            opacity: 1;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        /* Fix for checkbox sizing */
        input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        
        /* Make buttons more touch-friendly */
        button, 
        [role="button"],
        a[role="button"] {
            min-height: 44px;
            min-width: 44px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Mobile Overlay -->
    <div id="mobileOverlay" class="overlay" onclick="toggleMobileMenu()"></div>
    
    <!-- Mobile Sidebar -->
    <div id="mobileMenu" class="mobile-menu fixed inset-y-0 left-0 w-64 bg-gray-900 text-white z-50">
        <div class="p-4 border-b border-gray-800">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 rounded bg-indigo-500 flex items-center justify-center">
                        <i class="fas fa-chart-bar"></i>
                    </div>
                    <span class="text-lg font-bold">Analytics Board</span>
                </div>
                <button onclick="toggleMobileMenu()" class="text-gray-400 hover:text-white">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
        </div>
        
        <div class="p-4 border-b border-gray-800">
            <div class="flex items-center space-x-3">
                <div class="w-10 h-10 rounded-full bg-indigo-600 flex items-center justify-center">
                    <span id="mobileAvatar" class="text-white font-medium">HB</span>
                </div>
                <div>
                    <div id="mobileUserName" class="font-medium">Habeeb</div>
                    <div class="text-xs text-gray-400">Admin</div>
                </div>
            </div>
        </div>
        
        <nav class="flex-1 p-4 space-y-2 overflow-y-auto">
            <a href="#" class="flex items-center py-3 px-3 rounded bg-gray-800 text-white">
                <i class="fas fa-tachometer-alt mr-3"></i> Dashboard
            </a>
            <a href="#" class="flex items-center py-3 px-3 rounded text-gray-400 hover:bg-gray-800 hover:text-white">
                <i class="fas fa-store mr-3"></i> Stores
            </a>
            <a href="#" class="flex items-center py-3 px-3 rounded text-gray-400 hover:bg-gray-800 hover:text-white">
                <i class="fas fa-shield-alt mr-3"></i> Compliance
            </a>
            <a href="#" class="flex items-center py-3 px-3 rounded text-gray-400 hover:bg-gray-800 hover:text-white">
                <i class="fas fa-chart-line mr-3"></i> Analytics
            </a>
            <a href="#" class="flex items-center py-3 px-3 rounded text-gray-400 hover:bg-gray-800 hover:text-white">
                <i class="fas fa-cog mr-3"></i> Settings
            </a>
        </nav>
        
        <div class="p-4 border-t border-gray-800">
            <button class="w-full flex items-center py-3 px-3 rounded text-gray-400 hover:bg-gray-800 hover:text-white">
                <i class="fas fa-sign-out-alt mr-3"></i> Logout
            </button>
        </div>
    </div>

    <!-- Desktop Sidebar -->
    <div class="hidden md:flex md:flex-col md:w-64 bg-gray-900 text-white fixed inset-y-0 left-0">
        <div class="p-4 border-b border-gray-800">
            <div class="flex items-center space-x-3">
                <div class="w-8 h-8 rounded bg-indigo-500 flex items-center justify-center">
                    <i class="fas fa-chart-bar"></i>
                </div>
                <span class="text-lg font-bold">Analytics Board</span>
            </div>
        </div>
        
        <div class="p-4 border-b border-gray-800">
            <div class="flex items-center space-x-3">
                <div class="w-10 h-10 rounded-full bg-indigo-600 flex items-center justify-center">
                    <span id="desktopAvatar" class="text-white font-medium">HB</span>
                </div>
                <div>
                    <div id="desktopUserName" class="font-medium">Habeeb</div>
                    <div class="text-xs text-gray-400">Admin</div>
                </div>
            </div>
        </div>
        
        <nav class="flex-1 p-4 space-y-2 overflow-y-auto">
            <a href="#" class="flex items-center py-3 px-3 rounded bg-gray-800 text-white">
                <i class="fas fa-tachometer-alt mr-3"></i> Dashboard
            </a>
            <a href="#" class="flex items-center py-3 px-3 rounded text-gray-400 hover:bg-gray-800 hover:text-white">
                <i class="fas fa-store mr-3"></i> Stores
            </a>
            <a href="#" class="flex items-center py-3 px-3 rounded text-gray-400 hover:bg-gray-800 hover:text-white">
                <i class="fas fa-shield-alt mr-3"></i> Compliance
            </a>
            <a href="#" class="flex items-center py-3 px-3 rounded text-gray-400 hover:bg-gray-800 hover:text-white">
                <i class="fas fa-chart-line mr-3"></i> Analytics
            </a>
            <a href="#" class="flex items-center py-3 px-3 rounded text-gray-400 hover:bg-gray-800 hover:text-white">
                <i class="fas fa-cog mr-3"></i> Settings
            </a>
        </nav>
        
        <div class="p-4 border-t border-gray-800">
            <button class="w-full flex items-center py-3 px-3 rounded text-gray-400 hover:bg-gray-800 hover:text-white">
                <i class="fas fa-sign-out-alt mr-3"></i> Logout
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="md:ml-64">
        <!-- Top Navigation -->
        <header class="bg-white border-b border-gray-200 sticky top-0 z-30">
            <div class="flex items-center justify-between px-4 py-3">
                <div class="flex items-center">
                    <button onclick="toggleMobileMenu()" class="md:hidden mr-4 text-gray-600">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                    <h1 class="text-lg md:text-xl font-semibold text-gray-800">Welcome <span id="welcomeName">Habeeb</span>...</h1>
                </div>
                <div class="flex items-center space-x-3">
                    <button class="text-gray-600 hover:text-gray-900 p-2">
                        <i class="fas fa-bell text-lg"></i>
                        <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">3</span>
                    </button>
                    <button class="text-gray-600 hover:text-gray-900 p-2">
                        <i class="fas fa-question-circle text-lg"></i>
                    </button>
                    <button onclick="openSettings()" class="text-gray-600 hover:text-gray-900 p-2">
                        <i class="fas fa-user-cog text-lg"></i>
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content Area -->
        <main class="p-4 md:p-6 min-h-screen">
            <div class="max-w-6xl mx-auto">
                <!-- Compliance Score Summary -->
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-5">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500 mb-1">Overall Score</p>
                                <div class="text-3xl font-bold text-green-600">92%</div>
                            </div>
                            <div class="w-12 h-12 rounded-full bg-green-100 flex items-center justify-center">
                                <i class="fas fa-chart-bar text-green-600 text-xl"></i>
                            </div>
                        </div>
                        <div class="mt-4">
                            <div class="text-xs text-gray-500 mb-1">Compliance Level</div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-green-500 h-2 rounded-full" style="width: 92%"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-5">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500 mb-1">Critical Issues</p>
                                <div class="text-3xl font-bold text-gray-700">0</div>
                            </div>
                            <div class="w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center">
                                <i class="fas fa-exclamation-triangle text-gray-600 text-xl"></i>
                            </div>
                        </div>
                        <div class="mt-4">
                            <div class="text-xs text-gray-500">Requires immediate action</div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-5">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500 mb-1">Warnings</p>
                                <div class="text-3xl font-bold text-gray-700">0</div>
                            </div>
                            <div class="w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center">
                                <i class="fas fa-exclamation-circle text-gray-600 text-xl"></i>
                            </div>
                        </div>
                        <div class="mt-4">
                            <div class="text-xs text-gray-500">Needs attention soon</div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-5">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500 mb-1">Total Issues</p>
                                <div class="text-3xl font-bold text-gray-700">0</div>
                            </div>
                            <div class="w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center">
                                <i class="fas fa-list-alt text-gray-600 text-xl"></i>
                            </div>
                        </div>
                        <div class="mt-4">
                            <div class="text-xs text-gray-500">All identified problems</div>
                        </div>
                    </div>
                </div>
                
                <!-- Analysis Form -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-5 mb-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-5">Run New Compliance Analysis</h2>
                    <form id="analysisForm" onsubmit="return runAnalysis()">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-5 mb-5">
                            <div>
                                <label for="storeName" class="block text-sm font-medium text-gray-700 mb-2">
                                    Store Name <span class="text-red-500">*</span>
                                </label>
                                <input type="text" id="storeName" 
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white"
                                       placeholder="Enter store name"
                                       required>
                            </div>
                            
                            <div>
                                <label for="storeUrl" class="block text-sm font-medium text-gray-700 mb-2">
                                    Store URL <span class="text-red-500">*</span>
                                </label>
                                <input type="url" id="storeUrl" 
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white"
                                       placeholder="https://example.com"
                                       required>
                            </div>
                            
                            <div>
                                <label for="ticketId" class="block text-sm font-medium text-gray-700 mb-2">
                                    Ticket ID <span class="text-red-500">*</span>
                                </label>
                                <input type="text" id="ticketId" 
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white"
                                       placeholder="Enter ticket ID"
                                       required>
                            </div>
                        </div>
                        
                        <div class="mb-5">
                            <label class="block text-sm font-medium text-gray-700 mb-3">Select Compliance Checks</label>
                            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3">
                                <div class="flex items-center p-2 hover:bg-gray-50 rounded">
                                    <input type="checkbox" id="ipInfringement" name="checks" value="ipInfringement" 
                                           class="h-5 w-5 text-blue-600 rounded border-gray-300 focus:ring-blue-500"
                                           checked>
                                    <label for="ipInfringement" class="ml-3 text-sm text-gray-700 cursor-pointer">
                                        Intellectual Property Infringement
                                    </label>
                                </div>
                                
                                <div class="flex items-center p-2 hover:bg-gray-50 rounded">
                                    <input type="checkbox" id="apiLicense" name="checks" value="apiLicense" 
                                           class="h-5 w-5 text-blue-600 rounded border-gray-300 focus:ring-blue-500"
                                           checked>
                                    <label for="apiLicense" class="ml-3 text-sm text-gray-700 cursor-pointer">
                                        API License Violation
                                    </label>
                                </div>
                                
                                <div class="flex items-center p-2 hover:bg-gray-50 rounded">
                                    <input type="checkbox" id="httpHeaders" name="checks" value="httpHeaders" 
                                           class="h-5 w-5 text-blue-600 rounded border-gray-300 focus:ring-blue-500"
                                           checked>
                                    <label for="httpHeaders" class="ml-3 text-sm text-gray-700 cursor-pointer">
                                        Incomplete HTTP Response Headers
                                    </label>
                                </div>
                                
                                <div class="flex items-center p-2 hover:bg-gray-50 rounded">
                                    <input type="checkbox" id="sellerPermit" name="checks" value="sellerPermit" 
                                           class="h-5 w-5 text-blue-600 rounded border-gray-300 focus:ring-blue-500"
                                           checked>
                                    <label for="sellerPermit" class="ml-3 text-sm text-gray-700 cursor-pointer">
                                        Missing Seller Permit
                                    </label>
                                </div>
                                
                                <div class="flex items-center p-2 hover:bg-gray-50 rounded">
                                    <input type="checkbox" id="csrfCompliance" name="checks" value="csrfCompliance" 
                                           class="h-5 w-5 text-blue-600 rounded border-gray-300 focus:ring-blue-500"
                                           checked>
                                    <label for="csrfCompliance" class="ml-3 text-sm text-gray-700 cursor-pointer">
                                        CSRF Compliance Status
                                    </label>
                                </div>
                                
                                <div class="flex items-center p-2 hover:bg-gray-50 rounded">
                                    <input type="checkbox" id="gdprCompliance" name="checks" value="gdprCompliance" 
                                           class="h-5 w-5 text-blue-600 rounded border-gray-300 focus:ring-blue-500"
                                           checked>
                                    <label for="gdprCompliance" class="ml-3 text-sm text-gray-700 cursor-pointer">
                                        GDPR Compliance
                                    </label>
                                </div>
                                
                                <div class="flex items-center p-2 hover:bg-gray-50 rounded">
                                    <input type="checkbox" id="paymentSecurity" name="checks" value="paymentSecurity" 
                                           class="h-5 w-5 text-blue-600 rounded border-gray-300 focus:ring-blue-500"
                                           checked>
                                    <label for="paymentSecurity" class="ml-3 text-sm text-gray-700 cursor-pointer">
                                        Payment Security
                                    </label>
                                </div>
                                
                                <div class="flex items-center p-2 hover:bg-gray-50 rounded">
                                    <input type="checkbox" id="allChecks" 
                                           class="h-5 w-5 text-blue-600 rounded border-gray-300 focus:ring-blue-500"
                                           checked
                                           onclick="toggleAllChecks(this)">
                                    <label for="allChecks" class="ml-3 text-sm text-gray-700 font-medium cursor-pointer">
                                        Select All Checks
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="pt-2">
                            <button type="submit" 
                                    class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-6 rounded-lg focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-200">
                                <i class="fas fa-search mr-2"></i> Run Analysis
                            </button>
                        </div>
                    </form>
                </div>
                
                <!-- Results Section -->
                <div id="resultsSection" class="hidden bg-white rounded-xl shadow-sm border border-gray-200 p-5">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                        <h2 class="text-xl font-semibold text-gray-800">Analysis Results</h2>
                        <div class="flex flex-wrap gap-2">
                            <button onclick="exportPDF()" class="px-4 py-2 border border-gray-300 rounded-lg text-sm hover:bg-gray-50">
                                <i class="fas fa-file-pdf mr-2"></i> PDF
                            </button>
                            <button onclick="exportCSV()" class="px-4 py-2 border border-gray-300 rounded-lg text-sm hover:bg-gray-50">
                                <i class="fas fa-file-csv mr-2"></i> CSV
                            </button>
                            <button onclick="reanalyze()" class="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm hover:bg-blue-700">
                                <i class="fas fa-redo mr-2"></i> Re-analyze
                            </button>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                            <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                                <div class="text-sm text-gray-500 mb-1">Store Name</div>
                                <div id="resultStoreName" class="font-medium text-gray-800 text-lg">-</div>
                            </div>
                            <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                                <div class="text-sm text-gray-500 mb-1">Store URL</div>
                                <div id="resultStoreUrl" class="font-medium text-gray-800 text-lg">-</div>
                            </div>
                            <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                                <div class="text-sm text-gray-500 mb-1">Ticket ID</div>
                                <div id="resultTicketId" class="font-medium text-gray-800 text-lg">-</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <div class="flex space-x-6 border-b border-gray-200 overflow-x-auto pb-2">
                            <button id="tabAll" onclick="switchTab('all')" class="text-gray-600 hover:text-blue-600 font-medium pb-2 border-b-2 border-blue-600 text-blue-600 whitespace-nowrap">
                                All Issues
                            </button>
                            <button id="tabCritical" onclick="switchTab('critical')" class="text-gray-600 hover:text-blue-600 font-medium pb-2 border-b-2 border-transparent whitespace-nowrap">
                                Critical
                            </button>
                            <button id="tabWarnings" onclick="switchTab('warnings')" class="text-gray-600 hover:text-blue-600 font-medium pb-2 border-b-2 border-transparent whitespace-nowrap">
                                Warnings
                            </button>
                            <button id="tabInfo" onclick="switchTab('info')" class="text-gray-600 hover:text-blue-600 font-medium pb-2 border-b-2 border-transparent whitespace-nowrap">
                                Information
                            </button>
                        </div>
                    </div>
                    
                    <div id="resultsContainer" class="space-y-4">
                        <!-- Results will be added here -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Settings Modal -->
    <div id="settingsOverlay" class="overlay" onclick="closeSettings()"></div>
    <div id="settingsModal" class="settings-modal fixed inset-0 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-semibold text-gray-800">Edit Profile Settings</h3>
                    <button onclick="closeSettings()" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                
                <form onsubmit="saveProfile(event)" id="profileForm">
                    <div class="space-y-4">
                        <div>
                            <label for="editName" class="block text-sm font-medium text-gray-700 mb-2">Your Name</label>
                            <input type="text" id="editName" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                   value="Habeeb"
                                   required>
                        </div>
                        
                        <div>
                            <label for="editEmail" class="block text-sm font-medium text-gray-700 mb-2">Email Address</label>
                            <input type="email" id="editEmail" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                   value="habeeb@example.com"
                                   required>
                        </div>
                        
                        <div>
                            <label for="editRole" class="block text-sm font-medium text-gray-700 mb-2">Role</label>
                            <select id="editRole" 
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="admin" selected>Admin</option>
                                <option value="analyst">Compliance Analyst</option>
                                <option value="manager">Manager</option>
                                <option value="viewer">Viewer</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="editAvatar" class="block text-sm font-medium text-gray-700 mb-2">Avatar Initials</label>
                            <input type="text" id="editAvatar" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                   maxlength="2"
                                   value="HB"
                                   required>
                            <p class="text-xs text-gray-500 mt-2">Enter 2 characters for your avatar initials</p>
                        </div>
                        
                        <div class="pt-4">
                            <button type="submit" 
                                    class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-200">
                                Save Changes
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Dashboard loaded successfully');
            
            // Initialize all checkboxes as checked
            const checkboxes = document.querySelectorAll('input[name="checks"]');
            checkboxes.forEach(checkbox => {
                checkbox.checked = true;
            });
            
            // Test form inputs
            const formInputs = document.querySelectorAll('#analysisForm input, #analysisForm select, #analysisForm textarea');
            formInputs.forEach(input => {
                input.addEventListener('focus', function() {
                    console.log('Input focused:', this.id);
                });
                input.addEventListener('input', function() {
                    console.log('Input changed:', this.id, this.value);
                });
            });
            
            // Add click event to checkboxes for testing
            const allCheckboxes = document.querySelectorAll('input[type="checkbox"]');
            allCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('click', function(e) {
                    console.log('Checkbox clicked:', this.id, this.checked);
                    e.stopPropagation();
                });
                
                // Also add change event
                checkbox.addEventListener('change', function(e) {
                    console.log('Checkbox changed:', this.id, this.checked);
                });
            });
        });
        
        // Mobile menu functions
        function toggleMobileMenu() {
            const mobileMenu = document.getElementById('mobileMenu');
            const overlay = document.getElementById('mobileOverlay');
            
            mobileMenu.classList.toggle('active');
            overlay.classList.toggle('active');
            
            if (mobileMenu.classList.contains('active')) {
                document.body.style.overflow = 'hidden';
            } else {
                document.body.style.overflow = '';
            }
        }
        
        // Settings modal functions
        function openSettings() {
            const modal = document.getElementById('settingsModal');
            const overlay = document.getElementById('settingsOverlay');
            
            modal.classList.add('active');
            overlay.classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        
        function closeSettings() {
            const modal = document.getElementById('settingsModal');
            const overlay = document.getElementById('settingsOverlay');
            
            modal.classList.remove('active');
            overlay.classList.remove('active');
            document.body.style.overflow = '';
        }
        
        // Save profile function
        function saveProfile(event) {
            event.preventDefault();
            
            const newName = document.getElementById('editName').value;
            const newAvatar = document.getElementById('editAvatar').value;
            
            // Update name in all locations
            document.getElementById('welcomeName').textContent = newName;
            document.getElementById('desktopUserName').textContent = newName;
            document.getElementById('mobileUserName').textContent = newName;
            
            // Update avatar initials
            document.getElementById('desktopAvatar').textContent = newAvatar;
            document.getElementById('mobileAvatar').textContent = newAvatar;
            
            alert(`Profile updated successfully! Welcome ${newName}.`);
            closeSettings();
        }
        
        // Toggle all checks
        function toggleAllChecks(element) {
            const checkboxes = document.querySelectorAll('input[name="checks"]');
            const isChecked = element.checked;
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = isChecked;
            });
            
            console.log('All checkboxes toggled to:', isChecked);
        }
        
        // Run analysis function
        function runAnalysis() {
            console.log('Run Analysis function called');
            
            // Get form values
            const storeName = document.getElementById('storeName').value;
            const storeUrl = document.getElementById('storeUrl').value;
            const ticketId = document.getElementById('ticketId').value;
            
            console.log('Form values:', { storeName, storeUrl, ticketId });
            
            // Validate inputs
            if (!storeName || !storeUrl || !ticketId) {
                alert('Please fill in all required fields: Store Name, Store URL, and Ticket ID.');
                return false;
            }
            
            // Validate URL format
            try {
                new URL(storeUrl);
            } catch (e) {
                alert('Please enter a valid URL starting with http:// or https://');
                return false;
            }
            
            // Show loading state
            const runButton = document.querySelector('#analysisForm button[type="submit"]');
            const originalText = runButton.innerHTML;
            runButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Analyzing...';
            runButton.disabled = true;
            
            // Simulate API call
            setTimeout(() => {
                // Update results
                document.getElementById('resultStoreName').textContent = storeName;
                document.getElementById('resultStoreUrl').textContent = storeUrl;
                document.getElementById('resultTicketId').textContent = ticketId;
                
                // Update dashboard scores
                document.querySelector('.text-3xl.text-green-600').textContent = '39%';
                document.querySelector('.text-3xl.text-green-600').className = 'text-3xl font-bold text-red-600';
                document.querySelector('.bg-green-500.h-2').style.width = '39%';
                document.querySelector('.bg-green-500.h-2').className = 'bg-red-500 h-2 rounded-full';
                
                // Update issue counts
                document.querySelectorAll('.text-3xl.font-bold.text-gray-700')[0].textContent = '7';
                document.querySelectorAll('.text-3xl.font-bold.text-gray-700')[1].textContent = '5';
                document.querySelectorAll('.text-3xl.font-bold.text-gray-700')[2].textContent = '12';
                
                // Change icon colors for issues
                const issueIcons = document.querySelectorAll('.bg-gray-100');
                issueIcons[0].className = 'w-12 h-12 rounded-full bg-red-100 flex items-center justify-center';
                issueIcons[1].className = 'w-12 h-12 rounded-full bg-yellow-100 flex items-center justify-center';
                issueIcons[2].className = 'w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center';
                
                // Generate results
                generateResults();
                
                // Show results section
                document.getElementById('resultsSection').classList.remove('hidden');
                
                // Scroll to results
                document.getElementById('resultsSection').scrollIntoView({ 
                    behavior: 'smooth',
                    block: 'start'
                });
                
                // Reset button
                runButton.innerHTML = originalText;
                runButton.disabled = false;
                
                console.log('Analysis completed successfully');
            }, 1500);
            
            return false; // Prevent form submission
        }
        
        // Generate sample results
        function generateResults() {
            const resultsContainer = document.getElementById('resultsContainer');
            resultsContainer.innerHTML = '';
            
            const results = [
                {
                    title: "API License Violation",
                    severity: "high",
                    issues: [
                        {
                            title: "Unauthorized API Usage",
                            description: "Store is accessing Shopify APIs without proper authorization or exceeding rate limits in violation of Section 4.3 of the API License Agreement.",
                            risk: "High",
                            recommendation: "Immediately cease unauthorized API calls and implement proper authentication. Contact Shopify Partners for legitimate API integration solutions."
                        },
                        {
                            title: "Data Scraping Detected",
                            description: "Automated data extraction from Shopify platform detected without proper API credentials, violating Terms of Service and potentially compromising platform security.",
                            risk: "High",
                            recommendation: "Stop all scraping activities immediately and migrate to official Shopify APIs with proper authentication and rate limiting."
                        }
                    ]
                },
                {
                    title: "CSRF Compliance Status",
                    severity: "high",
                    issues: [
                        {
                            title: "Confidentiality Breach Risk",
                            description: "CSRF vulnerability detected - allows unauthorized actions on behalf of authenticated users, directly threatening confidentiality of customer data, transaction information, and Shopify platform security.",
                            risk: "High",
                            recommendation: "Immediate implementation of anti-CSRF tokens, validation of SameSite cookie attributes, and secure request validation to prevent unauthorized state-changing operations."
                        },
                        {
                            title: "Shopify ToS Violation",
                            description: "Active CSRF vulnerability violates Shopify Terms of Service Confidentiality clause (Section 10.1). Failing to address may result in immediate store suspension or termination.",
                            risk: "High",
                            recommendation: "Implement CSRF protection middleware, validate origin headers, and ensure all state-changing operations require unique tokens. Shopify Partners should be engaged for immediate remediation."
                        }
                    ]
                },
                {
                    title: "Intellectual Property Infringement",
                    severity: "none",
                    issues: []
                }
            ];
            
            results.forEach(result => {
                const card = document.createElement('div');
                card.className = 'border border-gray-200 rounded-lg overflow-hidden';
                
                if (result.severity === 'high') {
                    card.classList.add('border-l-4', 'border-l-red-500');
                } else if (result.severity === 'none') {
                    card.classList.add('bg-green-50', 'border-green-100');
                }
                
                let issuesHTML = '';
                
                if (result.issues.length > 0) {
                    result.issues.forEach(issue => {
                        issuesHTML += `
                            <div class="p-4 border-b border-gray-100 last:border-b-0">
                                <div class="flex flex-col sm:flex-row sm:justify-between sm:items-start mb-3 gap-2">
                                    <h4 class="font-medium text-gray-800 text-base">${issue.title}</h4>
                                    <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 shrink-0">
                                        ${issue.risk} Risk
                                    </span>
                                </div>
                                <p class="text-sm text-gray-600 mb-3">${issue.description}</p>
                                <div class="bg-blue-50 p-3 rounded-lg border border-blue-100">
                                    <h5 class="text-xs font-semibold text-blue-800 uppercase tracking-wider mb-1">Recommendation</h5>
                                    <p class="text-sm text-blue-700">${issue.recommendation}</p>
                                </div>
                            </div>
                        `;
                    });
                    
                    card.innerHTML = `
                        <div class="px-4 py-3 bg-gray-50 border-b border-gray-200 flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2">
                            <h3 class="font-semibold text-gray-800 text-lg">${result.title}</h3>
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800">
                                Critical (${result.issues.length} issues)
                            </span>
                        </div>
                        ${issuesHTML}
                    `;
                } else {
                    card.innerHTML = `
                        <div class="px-4 py-3 bg-green-50 border-b border-green-100 flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2">
                            <h3 class="font-semibold text-gray-800 text-lg">${result.title}</h3>
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                <i class="fas fa-check-circle mr-1"></i> Compliant
                            </span>
                        </div>
                        <div class="p-6 text-center">
                            <div class="w-16 h-16 rounded-full bg-green-100 flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-check text-green-600 text-2xl"></i>
                            </div>
                            <h4 class="font-medium text-gray-800 text-lg mb-2">No Issues Found</h4>
                            <p class="text-sm text-gray-600">This compliance area passes all security checks and meets Shopify requirements.</p>
                        </div>
                    `;
                }
                
                resultsContainer.appendChild(card);
            });
        }
        
        // Tab switching
        function switchTab(tabName) {
            // Reset all tabs
            const tabs = ['all', 'critical', 'warnings', 'info'];
            tabs.forEach(tab => {
                const tabElement = document.getElementById(`tab${tab.charAt(0).toUpperCase() + tab.slice(1)}`);
                if (tabElement) {
                    if (tab === tabName) {
                        tabElement.classList.add('border-blue-600', 'text-blue-600');
                        tabElement.classList.remove('border-transparent');
                    } else {
                        tabElement.classList.remove('border-blue-600', 'text-blue-600');
                        tabElement.classList.add('border-transparent');
                    }
                }
            });
            
            console.log('Switched to tab:', tabName);
        }
        
        // Export functions
        function exportPDF() {
            alert('PDF report will be generated. This feature would connect to a PDF generation service in a real application.');
        }
        
        function exportCSV() {
            alert('CSV file will be exported. This feature would generate a CSV download in a real application.');
        }
        
        // Re-analyze function
        function reanalyze() {
            // Hide results
            document.getElementById('resultsSection').classList.add('hidden');
            
            // Reset dashboard to 92%
            document.querySelector('.text-3xl').textContent = '92%';
            document.querySelector('.text-3xl').className = 'text-3xl font-bold text-green-600';
            document.querySelector('.h-2.rounded-full').style.width = '92%';
            document.querySelector('.h-2.rounded-full').className = 'bg-green-500 h-2 rounded-full';
            
            // Reset issue counts
            document.querySelectorAll('.text-3xl.font-bold')[1].textContent = '0';
            document.querySelectorAll('.text-3xl.font-bold')[2].textContent = '0';
            document.querySelectorAll('.text-3xl.font-bold')[3].textContent = '0';
            
            // Reset icon colors
            const issueIcons = document.querySelectorAll('.w-12.h-12.rounded-full');
            issueIcons[0].className = 'w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center';
            issueIcons[1].className = 'w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center';
            issueIcons[2].className = 'w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center';
            
            // Clear form
            document.getElementById('storeName').value = '';
            document.getElementById('storeUrl').value = '';
            document.getElementById('ticketId').value = '';
            
            // Scroll to form
            document.getElementById('analysisForm').scrollIntoView({ 
                behavior: 'smooth',
                block: 'start'
            });
            
            console.log('Re-analyze clicked');
        }
        
        // Test that everything is working
        console.log('Dashboard script loaded');
        console.log('Test: Click Run Analysis button to see results');
        console.log('Test: Click checkboxes to toggle them');
        console.log('Test: Click user icon in top right to edit profile');
    </script>
</body>
</html>
